var string = '\n\nhpevfwqjmjryhemuqjoiatpjmddxdjwzskdcfgdtbmkbcxrnmjuoyddnqwluimjwvguxehszxzvbmufq\nlrepncxxbrrzxnzmkoyhrjcstvfazyhrhgssximjdfcmdjusylfkwbedyrsxovrmvjzaljfjmywpfnjg\nisoqbdyspgzlcmdjmhbpxhzvvhckidzuwzkauffsujmcrhvgeqvasjakgtzlxkthjqwxypmsovjbfshr\nrxtdvkmbyhejoeydnrdowuwhgmbvxmpixyttglsjgmcoqbberssfjraaqfrkmebsozsjfnubhktbbai_\nvxbifbofyednnutmxtisvfsktbqfijfzdjoqybuohtztysqelaqyixyaiolbgwylwfisfwubivuoablx\nsmrqggedwyiqvseevwbcxcfjttdbweedcjgnsorizflsjtmltcoaynsrsupavqwcyzhgiplwkohlhrai\nnazaacvuqblpbzimgoxirejbshnbmdtgsbvlhpnugggencjaczqqiwixrwiyobmlkbwdlwcioqmjhoac\ndvcqdypxeichmgywocbcafumthdqrbjnpgnnmaasxiaxxfymcyiuqduztqneodstbcnjpeebgxgosoyd\nvpzlqjuroebbehafsemanwprhwkircuhlgcftqsjdusrqetbthxclfokpdlspxzuvhxpbeqqbfpqffsg\nyilqltfxrmtimcugytazkerhcfnirtavcnmfdyictlncwttkmxyfhgejygfefqrjknuqsfldmjmwjdfq\nsicfrzbfazchdgznekwmhridelcejnkmcgmpgtihbwmplrtrrefoyhyzxpjjlkabbbgspeokzhpjxsvp\nfjmdsoripvfrgyzxodoeirwwdaofdmwqrqyvdijlfqyzfspdoyrhewxbpufdqcpqdolkmrnvedixzpfd\nakggkslxcrjbrmnynviihbkzaqqffkkcgwjbettexhlwlasdfjnslwsmnclhafvebxxfdozsjtdvobik\nrrsuysujwliobagobxmlyxjeltwzwxpyrnkdxfemotfncyriaycyfemygjmpboocgtsvttqntegvleyn\nwgpjhyyysbltoxljsascsngbgfqmpzgpejzlmdkjzzlfxvagyrasmpzqntgqsvyqjugkhbrbkiqewlyf\ntvsq_______znp_____xkwt______wef______tz______kfc_______ha_______pn__lmg__iakrbt\niyfi__uojrxvx__tps__fp__pfpndbi__ggpalde__wmd__kn__ifiadob__hdljdbd__zl__whlwilt\nbcmt__haagmjg__dwx__oh__utnzudq__xstxxyc__vly__mr__viilzav__swosyvc__i__hnaqxyev\njykc__wyfoyir__ewp__ij__mrdavxl__tcdtxqy__fnr__cf__mrkepwj__djhrsau____lhefqxgmu\nzdgf______tjg__fip__mi__b____xc__vjvhpqy______vff_____wuup_____kqct___htiggvvpet\nyvco__pqbrlox__ayj__af__dnn__kx__mlitytx____jauna__kncmiym__dlwushk____gjptzccgc\nnntt__hfqyxzi__eqn__vz__hlh__we__dtfkfvf__g__litm__zeqjtdl__bkdapxs__o__oxeouwer\nbfjr__ipcqmop__kec__ip__icc__ci__vpxxueu__eq__sau__nhheydy__efqkdgq__us__pzlndhk\nhdmk__cmfvzwcb_____xdka______trj______yj__xpi__he_______nb_______by__rrn__tvxvig\njfpseyjjbrrtsfnmbrokdqtfzhhdtbhtvpiyshmvcqaypfxcvbgvbvwrkanjfcsjnanmktkwimnvynuk\ncmgtqmovkrdmfuduqvbqydagsttictcnsrhfrpoebcehdzhjamykqpjtktufcvokljjijjsrivyhxtgw\nojgoujyhmekzsoczwlqnruwcuhudgfaijzrkewzgjvorsmabpcdmurctwjrddcnkmfvabjwlbqssihdy\nbgfqchqdvjcsdllrlwmyikuvthguzfbgocaeqktvbcapzdcfjphqnhundtljqjeyfrkjspfvghqddxwx\nidtjjkctrkfcjmdpqyvavqbntpmkkuswfgbgalrysjfnzezjjscahoodjjelavydefzjmhsqfufsexlv\nvzziymsyqrcvhsrxjnysioswvjlqdbnwgyjlanmhzkbygkptycdoifsibytbrixggjeiepaybzxhvfsy\nayeptgpxbhhfkkpromhjykfxnujorlzcmkcmvvgmveyfkgiwgosznfpmbhixsakxfkuxhwcgularehpa\nguquulrjllxmkfzgnchrxzcfdklytpfnezergkwkhgalqlvdhkdgulgfaxtybqttcjtlgmfwaymaxlwa\nspyrboibwkzzbtgigyswbtpwxgphcmkfpmvbfjimnxctinqssshofhlvlpqcwiuacjyxyqmvaibezofv\natyhpqvjubgcwqeoytloypjphoxeimumuvswxkgamodoxiciwmgxvsenkgdhttzlenjbszrksopicjcj\nnvsosrapkfilwsaoptdavlfglioqpwoqskbgikksnnuzvmxyrtrbjouvgokxgbnwxnivtykvhjkaydsk\nzoowbhjrlojgeecdoggqqtomcdgrjzmlkhubyaewwtrlyutsptdrrigopueicoganyasrjeaiivzairu\nlklovyrpckwpowprxtvhaeivpudfchxbwvtosmivpcsesbzpsynxitlisuifuehceonjeydljzuzpsgj\nllcywoxbblitscquxiykcjxhsgkbhfhfrshsrpyrcaetahuwbeybvlvkthxydkapxlfikdwudjkmjjsa\nzajxpuikiqwsifhldfovqoycwmtlmcaycirhcehxnpfadrgyaogpcmomcgtmacnvbwfnimaqqvxijcbp\nmckwimloiinindfuakqjmpyjisxnbybtywhymnkdoyiphijzelmrazplgfcmcsjiovxqdxmuqulzklgx\n\n';


var PairBot = function PairBot() {
	this.string = stringTest;
	this.iteration = 0;
	this.pairs = null;
	this.existingPairs = null;

};

PairBot.prototype = {
	prepare: function(string) {
		var splitString = string.split('');
		return splitString;
	},
	restring: function(array) {
		var joinedArray = array.join("");
		return joinedArray;
	},
	reset: function() {
		this.pairs = [];
	},
	returnPairs: function() {
		var preparedString = this.prepare(this.string);
		this.pairs = findTargetPair(preparedString);
	},
	process: function() {
		do  {
			this.iteration++;
			var preparedString = this.prepare(this.string);
			this.pairs = findPairs(preparedString);
			var targetPair = this.pairs[0];
			// var targetPair = checkInnerPairs(pairs);
			if (targetPair === undefined) {
				console.log("all done!");
				this.string = this.restring(removeUnderscores(preparedString));
				document.getElementById('output').innerHTML += "<p>Iteration: "+this.iteration+", Output: "+this.string;
			}
			else {
			var shiftedArray = shiftCharacters(targetPair.start,targetPair.end,preparedString);
			this.string = this.restring(shiftedArray);

			// append iterations to document
			document.getElementById('output').innerHTML += "<p>Iteration: "+this.iteration+", Output: "+this.string;
			}
		} while (targetPair != undefined);

		return this.string;
	}
};

function checkInnerPairs(pairsCheck, pairsAll) {
	for (var i = 0; i < pairsCheck.length; i++) {
		var targetStart = pairsCheck[i].start;
		var targetEnd = pairsCheck[i].end;
		var pairsCompare = _.findIndex(pairsAll, function(e) {
			return e.start > targetStart && e.end < targetEnd;
		});
		if (pairsCompare === -1) {
			return;
		}
		else {
			pairsCheck[i].hasInnerPair = true;
		}
	}
}

function findPairs(charArray) {
	var pairs = [];
	var pairsToCheck = [];
	var position = 0;
	var stringLength = charArray.length;
	var currCharacter;
	while (position < stringLength) {
		currCharacter = charArray[position];

		for (var i = position; i < stringLength; i++) {
			while (currCharacter === charArray[i] && i > position) {
				var pair = {};

				pair.letter = currCharacter;
				pair.start = position;
				pair.end = i;
				pair.distance = i - position;
				pair.hasInnerPair = null;
				pairs.push(pair);
				break;
			}
			pairsToCheck = _.filter(pairs, {'hasInnerPair':null});
	
			console.log(pairs);
			checkInnerPairs(pairsToCheck,pairs);
			
		}
		position++;
	}

	pairsToCheck.sort(function(a,b) {
		if (a.distance === b.distance) {
			return a.start - b.start;
		}
		else {
			return b.distance - a.distance;
		}
	});
	console.log(pairsToCheck[0]);
	return pairsToCheck;
}





function shiftCharacters(firstChar,lastChar,array) {
	array.splice(firstChar,1);
	var lastChar = array.splice(lastChar-1,1);
	array.push(lastChar[0]);
	return array;
}

function removeUnderscores(characters) {
	for (var i = 0; i < characters.length; i++) {
		if (characters[i] === '_') {
			characters.splice(i,characters.length);
		}
	}
	return characters;
}

stringTest = 'abacbcbefge';

pairbot = new PairBot();
var start = performance.now();
pairbot.process(this.string);
var duration = performance.now() - start;
console.log(duration);